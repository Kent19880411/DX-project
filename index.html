<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>事業計画 プロジェクト管理ツール</title>
    <style>
        :root {
            --primary-color: #4a90e2;
            --background-color: #f4f7f9;
            --text-color: #333;
            --border-color: #ddd;
            --header-bg: #e9eff4;
            --completed-color: #999;
            --completed-bg: #f0f0f0;
            --danger-color: #dc3545;
            --danger-hover-color: #c82333;
        }
        body {
            font-family: 'Segoe UI', 'Meiryo', 'Hiragino Kaku Gothic ProN', sans-serif;
            line-height: 1.6;
            background-color: var(--background-color);
            color: var(--text-color);
            margin: 0;
            padding: 20px;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background-color: #fff;
            padding: 25px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        h1 {
            color: var(--primary-color);
            border-bottom: 2px solid var(--primary-color);
            padding-bottom: 10px;
            margin-top: 0;
        }
        .overall-progress {
            margin-bottom: 25px;
        }
        .overall-progress label {
            font-weight: bold;
            display: block;
            margin-bottom: 5px;
        }
        progress {
            width: 100%;
            height: 25px;
            accent-color: var(--primary-color);
        }
        .phase {
            margin-bottom: 20px;
            border: 1px solid var(--border-color);
            border-radius: 5px;
            overflow: hidden;
        }
        .phase-header {
            background-color: var(--header-bg);
            padding: 10px 15px;
            cursor: pointer;
            user-select: none;
        }
        .phase-header h2 {
            margin: 0;
            font-size: 1.2em;
            display: inline-block;
        }
        .phase-header:hover {
            background-color: #dbe4ec;
        }
        .phase-progress {
            float: right;
            font-size: 0.9em;
            font-weight: bold;
        }
        .phase-content {
            padding: 15px;
        }
        table {
            width: 100%;
            border-collapse: collapse;
        }
        th, td {
            text-align: left;
            padding: 12px 8px;
            border-bottom: 1px solid var(--border-color);
            vertical-align: middle;
        }
        th {
            background-color: #f9fafb;
        }
        tr.completed td:not(:last-child) {
            text-decoration: line-through;
            color: var(--completed-color);
        }
        tr.completed {
            background-color: var(--completed-bg);
        }
        input[type="checkbox"] {
            transform: scale(1.3);
            cursor: pointer;
        }
        .task-name.sub-task { padding-left: 20px; }
        .task-name.sub-sub-task { padding-left: 40px; }
        .editable {
            cursor: text;
            min-width: 80px;
        }
        .editable:focus {
            background-color: #fff3cd;
            outline: 2px solid #ffeeba;
            border-radius: 2px;
        }
        input[type="date"] {
            border: 1px solid transparent;
            background-color: transparent;
            padding: 2px;
            font-family: inherit;
            font-size: inherit;
            width: 130px;
        }
        input[type="date"]:focus {
            border: 1px solid var(--border-color);
        }
        .action-cell { text-align: center; }
        .delete-btn {
            background: none;
            border: none;
            color: #aaa;
            cursor: pointer;
            font-size: 1.2em;
            padding: 0 5px;
        }
        .delete-btn:hover { color: var(--danger-color); }
        .add-task-btn {
            background-color: #f0f0f0;
            border: 1px dashed #ccc;
            color: #555;
            padding: 10px;
            width: 100%;
            cursor: pointer;
            border-radius: 4px;
            margin-top: 10px;
            font-weight: bold;
        }
        .add-task-btn:hover { background-color: #e9e9e9; border-color: #bbb;}
        .controls-container {
            text-align: right;
            margin-top: 20px;
        }
        #reset-data-button {
            background-color: var(--danger-color);
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.9em;
        }
        #reset-data-button:hover { background-color: var(--danger-hover-color); }
    </style>
</head>
<body>

    <div class="container">
        <h1>事業基盤構築プロジェクト管理</h1>

        <div class="overall-progress">
            <label for="overall-progress-bar">全体進捗</label>
            <progress id="overall-progress-bar" value="0" max="100"></progress>
        </div>

        <!-- フェーズ1 -->
        <details class="phase" open>
            <summary class="phase-header">
                <h2>フェーズ1：事業基盤構築フェーズ（1〜3ヶ月）</h2>
                <span class="phase-progress" id="phase-1-progress-text">0%</span>
            </summary>
            <div class="phase-content" data-phase-id="1">
                <table>
                    <thead>
                        <tr>
                            <th style="width:5%;">完了</th>
                            <th style="width:45%;">タスク</th>
                            <th style="width:15%;">担当者</th>
                            <th style="width:15%;">期限</th>
                            <th style="width:10%;">メモ</th>
                            <th style="width:10%;">操作</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
                <button class="add-task-btn">＋ タスクを追加</button>
            </div>
        </details>

        <!-- フェーズ2 -->
        <details class="phase" open>
            <summary class="phase-header">
                <h2>フェーズ2：テストマーケティング・初期案件獲得フェーズ（4〜6ヶ月）</h2>
                <span class="phase-progress" id="phase-2-progress-text">0%</span>
            </summary>
            <div class="phase-content" data-phase-id="2">
                 <table>
                    <thead>
                        <tr>
                            <th style="width:5%;">完了</th>
                            <th style="width:45%;">タスク</th>
                            <th style="width:15%;">担当者</th>
                            <th style="width:15%;">期限</th>
                            <th style="width:10%;">メモ</th>
                            <th style="width:10%;">操作</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
                <button class="add-task-btn">＋ タスクを追加</button>
            </div>
        </details>
        
        <!-- フェーズ3 -->
        <details class="phase" open>
            <summary class="phase-header">
                <h2>フェーズ3：事業本格展開・拡大フェーズ（7ヶ月目以降）</h2>
                <span class="phase-progress" id="phase-3-progress-text">0%</span>
            </summary>
            <div class="phase-content" data-phase-id="3">
                 <table>
                    <thead>
                        <tr>
                            <th style="width:5%;">完了</th>
                            <th style="width:45%;">タスク</th>
                            <th style="width:15%;">担当者</th>
                            <th style="width:15%;">期限</th>
                            <th style="width:10%;">メモ</th>
                            <th style="width:10%;">操作</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
                <button class="add-task-btn">＋ タスクを追加</button>
            </div>
        </details>
        
        <div class="controls-container">
            <button id="reset-data-button">進捗データをリセット</button>
        </div>
    </div>

    <script>
    document.addEventListener('DOMContentLoaded', function() {
        // 初期タスクデータ（変更不可）
        const initialTasks = [
            // Phase 1
            { id: '1', phase: 1, text: 'A. パートナーシップ確立', level: 0, isHeader: true },
            { id: '1.1', phase: 1, text: '1. Google Workspace販売代理店契約の締結', level: 1 },
            { id: '1.1.1', phase: 1, text: '1-1. ディストリビューターの選定と連絡、条件交渉', level: 2 },
            { id: '1.1.2', phase: 1, text: '1-2. 申込書類の準備と提出', level: 2 },
            { id: '1.1.3', phase: 1, text: '1-3. 契約内容の精査と締結', level: 2 },
            { id: '1.2', phase: 1, text: '2. IT導入支援事業者との連携', level: 1 },
            { id: '1.2.1', phase: 1, text: '2-1. 連携候補となるIT導入支援事業者のリストアップと調査', level: 2 },
            { id: '1.2.2', phase: 1, text: '2-2. 連携協議（コンソーシアム組成等）の実施と条件交渉', level: 2 },
            { id: '1.2.3', phase: 1, text: '2-3. 連携に関する覚書・契約の締結', level: 2 },
            { id: '2', phase: 1, text: 'B. サービス・組織体制の構築', level: 0, isHeader: true },
            { id: '2.1', phase: 1, text: '3. フリーランス専門家チームの組成（初期メンバー）', level: 1 },
            { id: '2.1.1', phase: 1, text: '3-1. 既存フリーランスネットワークへのスキル調査と協力依頼', level: 2 },
            { id: '2.1.2', phase: 1, text: '3-2. 新規事業に必要な採用要件の最終決定', level: 2 },
            { id: '2.1.3', phase: 1, text: '3-3. 不足スキルを補うための外部募集チャネルの選定', level: 2 },
            { id: '2.1.4', phase: 1, text: '3-4. 面接・評価プロセスの確立と実施', level: 2 },
            { id: '2.1.5', phase: 1, text: '3-5. 初期メンバーとの業務委託契約締結', level: 2 },
            { id: '2.2', phase: 1, text: '4. サービスメニューと価格体系の最終決定', level: 1 },
            { id: '2.2.1', phase: 1, text: '4-1. 工数ベースの価格設定モデルの確定', level: 2 },
            { id: '2.2.2', phase: 1, text: '4-2. 各種プランの詳細なサービス内容の定義', level: 2 },
            { id: '2.2.3', phase: 1, text: '4-3. 提案書、見積書、契約書等の各種テンプレート作成', level: 2 },
            { id: '2.3', phase: 1, text: '5. フリーランス品質管理プロセスの構築', level: 1 },
            { id: '2.3.1', phase: 1, text: '5-1. オンボーディングプログラムのコンテンツ作成', level: 2 },
            { id: '2.3.2', phase: 1, text: '5-2. 業務マニュアル、品質チェックリストの作成', level: 2 },
            { id: '3', phase: 1, text: 'C. マーケティング準備', level: 0, isHeader: true },
            { id: '3.1', phase: 1, text: '6. オンラインAI無料研修の企画・準備', level: 1 },
            { id: '3.1.1', phase: 1, text: '6-1. 研修テーマと詳細なアジェンダの決定', level: 2 },
            { id: '3.1.2', phase: 1, text: '6-2. 登壇者の決定とリハーサル', level: 2 },
            { id: '3.1.3', phase: 1, text: '6-3. 使用するウェビナーツールの選定と契約', level: 2 },
            { id: '3.1.4', phase: 1, text: '6-4. 集客用LPおよび申込フォームの作成', level: 2 },
            // Phase 2
            { id: '4', phase: 2, text: 'A. マーケティング施策の開始', level: 0, isHeader: true },
            { id: '4.1', phase: 2, text: '7. 既存顧客への先行案内', level: 1 },
            { id: '4.1.1', phase: 2, text: '7-1. 案内用メールマガジンの作成と配信', level: 2 },
            { id: '4.1.2', phase: 2, text: '7-2. RPO事業の営業担当者による個別案内の実施', level: 2 },
            { id: '4.2', phase: 2, text: '8. 第1回オンラインAI無料研修の実施', level: 1 },
            { id: '4.2.1', phase: 2, text: '8-1. 集客活動の実施（メール、SNS広告等）', level: 2 },
            { id: '4.2.2', phase: 2, text: '8-2. ウェビナーの実施とアンケート回収', level: 2 },
            { id: '5', phase: 2, text: 'B. 初期案件の獲得とサービス提供', level: 0, isHeader: true },
            { id: '5.1', phase: 2, text: '9. 個別相談会の実施', level: 1 },
            { id: '5.1.1', phase: 2, text: '9-1. 研修参加者へのフォローアップと個別相談への誘導', level: 2 },
            { id: '5.1.2', phase: 2, text: '9-2. 課題ヒアリングと、それに合わせたソリューション提案活動', level: 2 },
            { id: '5.2', phase: 2, text: '10. 初期案件の契約とプロジェクト開始', level: 1 },
            { id: '5.2.1', phase: 2, text: '10-1. 契約手続きの実施', level: 2 },
            { id: '5.2.2', phase: 2, text: '10-2. 担当フリーランスのアサインとキックオフミーティングの開催', level: 2 },
            { id: '5.2.3', phase: 2, text: '10-3. サービス提供と品質管理プロセスの実践', level: 2 },
            // Phase 3
            { id: '6', phase: 3, text: 'A. 事業運営の本格化', level: 0, isHeader: true },
            { id: '6.1', phase: 3, text: '11. 定期的な事業レビューと改善', level: 1 },
            { id: '6.1.1', phase: 3, text: '11-1. KGI/KPIの進捗確認（月次レビュー会議の設定）', level: 2 },
            { id: '6.1.2', phase: 3, text: '11-2. 顧客満足度アンケートの分析とサービス改善への反映', level: 2 },
            { id: '6.1.3', phase: 3, text: '11-3. フリーランスからのフィードバック収集と業務プロセスの改善', level: 2 },
            { id: '6.2', phase: 3, text: '12. オンライン研修の定例化', level: 1 },
            { id: '6.2.1', phase: 3, text: '12-1. 研修テーマの拡充', level: 2 },
            { id: '6.2.2', phase: 3, text: '12-2. 定期開催スケジュールの策定と告知', level: 2 },
            { id: '7', phase: 3, text: 'B. 事業拡大', level: 0, isHeader: true },
            { id: '7.1', phase: 3, text: '13. 新規顧客向けマーケティングの開始', level: 1 },
            { id: '7.1.1', phase: 3, text: '13-1. Web広告、コンテンツマーケティングの開始', level: 2 },
            { id: '7.1.2', phase: 3, text: '13-2. パートナー企業との連携模索とアライアンス構築', level: 2 },
            { id: '7.2', phase: 3, text: '14. 導入事例の創出と横展開', level: 1 },
            { id: '7.2.1', phase: 3, text: '14-1. 初期顧客の成功事例をヒアリングし、コンテンツ化', level: 2 },
            { id: '7.2.2', phase: 3, text: '14-2. 事例を活用した営業資料のアップデートとWebサイトでの公開', level: 2 },
            { id: '7.3', phase: 3, text: '15. フリーランス採用の継続とコミュニティ化', level: 1 },
            { id: '7.3.1', phase: 3, text: '15-1. 事業拡大に合わせた継続的なフリーランスの採用活動', level: 2 },
            { id: '7.3.2', phase: 3, text: '15-2. フリーランス向けの情報共有会や勉強会の企画・実施', level: 2 },
        ];
        
        const STORAGE_KEY = 'projectTrackerData_v2';
        const container = document.querySelector('.container');

        function getPaddingClass(level) {
            if (level === 1) return 'sub-task';
            if (level === 2) return 'sub-sub-task';
            return '';
        }

        function createTaskRow(task, taskData = {}) {
            const tr = document.createElement('tr');
            tr.dataset.taskId = task.id;
            tr.dataset.phase = task.phase;
            if (task.isHeader) {
                tr.innerHTML = `<td colspan="6" style="background-color: #f3f3f3; font-weight: bold;">${task.text}</td>`;
                return tr;
            }

            const isCompleted = taskData.completed || false;
            if (isCompleted) {
                tr.classList.add('completed');
            }

            tr.innerHTML = `
                <td><input type="checkbox" ${isCompleted ? 'checked' : ''}></td>
                <td class="task-name editable ${getPaddingClass(task.level)}" contenteditable="true">${taskData.text || task.text}</td>
                <td class="editable" contenteditable="true">${taskData.assignee || ''}</td>
                <td><input type="date" value="${taskData.dueDate || ''}"></td>
                <td class="editable" contenteditable="true">${taskData.notes || ''}</td>
                <td class="action-cell"><button class="delete-btn" title="タスクを削除">×</button></td>
            `;
            return tr;
        }

        function renderAllTasks() {
            const data = loadData();
            // 既存の動的タスク（初期タスク以外）と初期タスクを結合
            const allTasks = [...initialTasks];
            for (const id in data) {
                if (!initialTasks.some(t => t.id === id)) {
                    allTasks.push({ id, ...data[id] });
                }
            }

            allTasks.forEach(task => {
                const tableBody = document.querySelector(`.phase-content[data-phase-id="${task.phase}"] tbody`);
                if (tableBody) {
                    const taskData = data[task.id] || {};
                    const row = createTaskRow(task, taskData);
                    tableBody.appendChild(row);
                }
            });
            updateAllProgress();
        }

        function updateAllProgress() {
            for (let i = 1; i <= 3; i++) {
                updatePhaseProgress(i);
            }
            updateOverallProgress();
        }

        function updatePhaseProgress(phaseNum) {
            const phaseTasks = document.querySelectorAll(`.phase-content[data-phase-id="${phaseNum}"] tbody tr`);
            const relevantTasks = Array.from(phaseTasks).filter(tr => tr.querySelector('input[type="checkbox"]'));
            if (relevantTasks.length === 0) {
                document.getElementById(`phase-${phaseNum}-progress-text`).textContent = `0%`;
                return;
            }
            const completedTasks = Array.from(relevantTasks).filter(tr => tr.querySelector('input[type="checkbox"]').checked);
            const progress = (completedTasks.length / relevantTasks.length) * 100;
            document.getElementById(`phase-${phaseNum}-progress-text`).textContent = `${Math.round(progress)}%`;
        }

        function updateOverallProgress() {
            const allCheckboxes = document.querySelectorAll('tbody input[type="checkbox"]');
            if (allCheckboxes.length === 0) {
                document.getElementById('overall-progress-bar').value = 0;
                return;
            }
            const completedCheckboxes = document.querySelectorAll('tbody input[type="checkbox"]:checked');
            const progress = (completedCheckboxes.length / allCheckboxes.length) * 100;
            document.getElementById('overall-progress-bar').value = progress;
        }

        function saveData() {
            const dataToSave = {};
            document.querySelectorAll('tbody tr[data-task-id]').forEach(tr => {
                const id = tr.dataset.taskId;
                if(tr.querySelector('td[colspan="6"]')) return; // Skip header rows

                const checkbox = tr.querySelector('input[type="checkbox"]');
                const cells = tr.querySelectorAll('td');
                dataToSave[id] = {
                    phase: tr.dataset.phase,
                    text: cells[1].textContent.trim(),
                    completed: checkbox.checked,
                    assignee: cells[2].textContent.trim(),
                    dueDate: tr.querySelector('input[type="date"]').value,
                    notes: cells[4].textContent.trim(),
                    level: 2 // 新規タスクはインデントレベル2とする
                };
            });
            localStorage.setItem(STORAGE_KEY, JSON.stringify(dataToSave));
        }

        function loadData() {
            const savedData = localStorage.getItem(STORAGE_KEY);
            return savedData ? JSON.parse(savedData) : {};
        }
        
        // --- Event Listeners using Delegation ---
        
        // For 'change' events (checkbox, date)
        container.addEventListener('change', (e) => {
            if (e.target.matches('input[type="checkbox"]')) {
                const tr = e.target.closest('tr');
                tr.classList.toggle('completed', e.target.checked);
                saveData();
                updateAllProgress();
            } else if (e.target.matches('input[type="date"]')) {
                saveData();
            }
        });

        // For 'blur' on contenteditable cells
        container.addEventListener('blur', (e) => {
            if (e.target.matches('.editable')) {
                saveData();
            }
        }, true); // Use capture phase for blur event

        // For 'click' events (add, delete)
        container.addEventListener('click', (e) => {
            // Delete Task
            if (e.target.matches('.delete-btn')) {
                const tr = e.target.closest('tr');
                const taskText = tr.querySelector('.task-name').textContent;
                if (confirm(`タスク「${taskText.trim()}」を本当に削除しますか？`)) {
                    tr.remove();
                    saveData();
                    updateAllProgress();
                }
            }
            // Add Task
            if (e.target.matches('.add-task-btn')) {
                const phaseContent = e.target.closest('.phase-content');
                const tableBody = phaseContent.querySelector('tbody');
                const phaseId = phaseContent.dataset.phaseId;
                
                const newTask = {
                    id: 'task_' + Date.now(),
                    phase: phaseId,
                    text: '新しいタスク',
                    level: 2, // Default to sub-sub-task level
                };

                const newRow = createTaskRow(newTask);
                tableBody.appendChild(newRow);
                saveData();
                updateAllProgress();
            }
        });

        // Reset Button
        document.getElementById('reset-data-button').addEventListener('click', function() {
            if (confirm('本当にすべての進捗データをリセットしますか？この操作は元に戻せません。')) {
                localStorage.removeItem(STORAGE_KEY);
                location.reload();
            }
        });

        // Initial render
        renderAllTasks();
    });
    </script>
</body>
</html>
